# 访问权限控制

我们经常需要对代码进行重构。但是，客户端程序员需要你的代码在某些方面保持不变。这就产生了冲突。

这对类库而言尤其重要。该类库的消费者必须依赖他所使用的那部分类库，并且能够知道如果类库出现了新版本，他们并不需要改写代码。从另一个方面来说，类库的开发者必须有权限进行修改和改进，并确保客户代码不会因为这些改动而受到影响。

为了解决这一问题，Java 提供了访问权限修饰词，以供类库开发人员向客户端程序员指明哪些是可用的，哪些是不可用的。另外，对于如何将构件捆绑到一个内聚的类库单元中的问题，Java 用关键字 `package` 加以控制，而访问权限修饰词会因类是存在于一个相同的包，还是存在于一个单独的包而受到影响。

## 包：库单元

为了防止类名称之间的冲突问题，Java 提供了包这一概念。
包就是一个库单元，它包含有一组类，这些类在单一的名字空间下被组织在了一起。按照惯例，包的第一部分是创建者的反序的 Internet 域名，它是独一无二的，因此包名也将是独一无二的。这样，通过包可以为每个类都创建一个唯一的标识符组合。

要为类指定所属的包，应该使用 `package` 语句，它必须是文件中的第一句程序代码：

```java
package java.util;
```

要在代码中引入一个类，必须要指定这个类是位于哪一个包下的。具体有如下两种方法：

*   使用类的全名来指定。

	```java
	java.util.ArrayList list = new java.util.ArrayList();
	```
	
*   使用 `import` 关键字来导入这个类。

	```java
	import java.util.ArrayList;
	// import java.util.*;
	
	...
	```
	
当编写一个 Java 源文件时，此文件通常被称为编译单元。每个编译单元都必须有一个后缀名 `.java`，而在编译单元内可以有一个 `public` 类，该类的名称必须与文件的名称相同。每个编译单元只能有一个 `public` 类，否则编译器就不会接受。如果在该编译单元之中还有额外的类的话，那么在包之外的世界是无法看到这个类的，这是因为它们不是 `public` 类，而且它们主要用来为主 `public` 类提供支持。

当编译一个 `.java` 文件时，在 `.java` 文件中的每个类都会有一个输出文件，而该输出文件的名称与 `.java` 文件中每个类的名称相同，只是多了一个后缀 `.class`。因此，在编译少量的 `.java` 文件后，可能会得到大量的 `.class` 文件。

Java 解释器负责 `class` 文件的查找、装载和解释。首先，它找出环境变量 `CLASSPATH`。`CLASSPATH` 包含一个或多个目录，用作查找 `.class` 文件的根目录。从根目录开始，解释器根据包名产生一个路径名称（例如，`package foo.bar.baz` 就变成类似 `foo/bar/baz` 的路径）。得到的路径名称与 `CLASSPATH` 中的各个不同的项相连接，解释器就在这些目录中查找与你所要创建的类名称相关的 `.class` 文件。

## Java 访问权限修饰词

### 类成员的访问权限

在类的成员（无论是域还是方法）之前，可以指定 `publc`、`protected` 和 `private` 访问权限。如果不提供任何访问权限修饰词，则意味着该成员是“包访问权限”。
 
要取得对某成员的访问权，具有下列途径：

1.  使该成员成为 `public`。

2.  如果该成员是包访问权限的，那么可以把其他类放置于同一个包内。

3.  派生类可以访问父类的 `public` 成员和 `protected` 成员。只有当两个类处于同一个包内时，它才可以访问包访问权限的成员。

4.  提供访问器（accessor）和变异器（mutator）方法（也称作 get/set 方法）。对面向对象编程而言，这是最优雅的方式。

下面介绍四种不同的访问权限：
 
*   **包访问权限**
	默认的访问权限没有任何关键字，它表示包访问权限。这意味着当前包中的所有其他类都可以访问这个成员，但是这个包外的所有类却不能访问。

*   **public：接口访问权限**

	`public` 成员对每个人都是可用的，尤其是使用类库的客户端程序员更是如此。
	
	对于想要公开给客户端程序员使用的成员，应该声明为 `public`。
	
*   **private：私有访问权限**

	除了包含该 `private` 成员的的类之外，其他任何类都无法访问这个成员。
	
	对于一个域，应该尽可能将其指定为 `private`，除非必须公开其底层实现细目（很少见）。对于一个方法，如果它只是该类的一个“助手”方法的话，就可以把它指定为 `private`。
	
	`private` 成员具有以下用途：
	
	* 将构造器声明为 `private`，可以阻止别人直接创建该类的实例。相反，只能在这个类内部创建自身的实例，参考“单例模式”。
	
	* `private` 成员的应用在多线程环境下非常重要。
	
*   **protected：继承访问权限**

	派生类可以访问基类的 `protected` 成员。另外，`protected` 也提供包访问权限，也就是说，相同包内的其他类可以访问 protected 元素。
	
	尽管可以创建 `protected` 域，但是最好的方式还是将域保持为 `private`，然后通过 `protected` 方法来控制类的继承者的访问权限。
	
### 类的访问权限

在类之前，可以指定 `public` 访问权限，也可以创建一个包访问权限的类。所以，对于类的访问权限，只有 `public` 和包访问权限两种选择。

注意，类不可以是 `private` 或 `protected` 的；内部类却可以是 `private` 或 `protected` 的，这是一个特例。

如果不希望其他任何人对该类拥有访问权限，可以把所有的构造器都指定为 `private`，从而阻止任何人创建该类的实例。唯一的例外是，你可以在该类的 `static` 成员内部创建。参考“单例模式”。